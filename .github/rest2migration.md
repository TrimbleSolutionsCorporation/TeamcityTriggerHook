<!-- TOC -->
* [REST v2 Migration Guide](#rest-v2-migration-guide)
  * [Migration steps](#markdown-header-migration-steps)
  * [Features breakdown](#markdown-header-features-breakdown)
    * [Basic features](#markdown-header-basic-features)
    * [Security features](#markdown-header-security-features)
    * [Advanced features](#markdown-header-advanced-features)
    * [Miscellaneous](#markdown-header-miscellaneous)
    * [REST v2 plugin samples](#markdown-header-rest-v2-plugin-samples)
  * [Details on Feature Migration](#markdown-header-details-on-feature-migration)
    * [REST v2 Interceptor and execution order migration guide](#markdown-header-rest-v2-interceptor-and-execution-order-migration-guide)
      * [Breaking changes](#markdown-header-breaking-changes)
      * [Migration guide for interceptors and execution order](#markdown-header-migration-guide-for-interceptors-and-execution-order)
    * [REST v2 Filter and execution order migration guide](#rest-v2-filter-and-execution-order-migration-guide)
      * [Breaking changes](#markdown-header-breaking-changes-1)
      * [Filter differences between REST v1 and REST v2](#markdown-header-filter-differences-between-rest-v1-and-rest-v2)
      * [Detailed comparison of filters between REST v1 and REST v2](#markdown-header-detailed-comparison-of-filters-between-rest-v1-and-rest-v2)
      * [ResourceFilterFactory replaced by DynamicFeature](#markdown-header-resourcefilterfactory-replaced-by-dynamicfeature)
        * [Practical example](#markdown-header-practical-example)
      * [ResourceFilters annotation replaced by Name Binding or Dynamic Binding](#markdown-header-resourcefilters-annotation-replaced-by-name-binding-or-dynamic-binding)
      * [Access-related annotations (SystemAdmin and AdminOnly)](#markdown-header-access-related-annotations--systemadmin-and-adminonly-)
    * [REST v2 security features migration guide](#markdown-header-rest-v2-security-features-migration-guide)
      * [Authentication Check](#markdown-header-authentication-check)
      * [Cross-Site Request Forgery (XSRF) Protection](#markdown-header-cross-site-request-forgery--xsrf--protection)
      * [Cross-Origin Resource Sharing (CORS) Check](#markdown-header-cross-origin-resource-sharing--cors--check)
      * [Anti-sniffing Protection](#markdown-header-anti-sniffing-protection)
      * [Web Sudo Check](#markdown-header-web-sudo-check)
      * [POJO](#markdown-header-pojo)
      * [Authentication context](#markdown-header-authentication-context)
    * [REST v2 expansion migration guide](#rest-v2-expansion-migration-guide)
      * [Package structure](#markdown-header-package-structure)
      * [Public API](#markdown-header-public-api)
      * [Plugin internal API](#markdown-header-plugin-internal-api)
      * [Removed classes](#markdown-header-removed-classes)
      * [Import these classes as OSGi beans](#markdown-header-import-these-classes-as-osgi-beans)
      * [Expanding Collection Types is no longer supported](#markdown-header-expanding-collection-types-is-no-longer-supported)
        * [Specific to Jira](#markdown-header-specific-to-jira)
    * [REST v2 Transaction Interceptor migration guide](#markdown-header-rest-v2-transaction-interceptor-migration-guide)
      * [Breaking changes](#markdown-header-breaking-changes-2)
      * [Migration guide for TransactionInterceptor](#markdown-header-migration-guide-for-transactioninterceptor)
    * [REST v2 Validation Interceptor migration guide](#markdown-header-rest-v2-validation-interceptor-migration-guide)
      * [Breaking changes](#markdown-header-breaking-changes-3)
      * [Migration guide for `ValidationInterceptor`](#markdown-header-migration-guide-for-validationinterceptor)
    * [REST v2 RestUrlBuilder migration guide](#markdown-header-rest-v2-resturlbuilder-migration-guide)
      * [Package migrations](#markdown-header-package-migrations)
      * [Code deprecations](#markdown-header-code-deprecations)
      * [Example](#markdown-header-example)
        * [Atlassian REST v1](#markdown-header-atlassian-rest-v1)
        * [Atlassian REST v2](#markdown-header-atlassian-rest-v2)
  * [Common problems and solutions](#markdown-header-common-problems-and-solutions)
      * [Problem 1 - NoSuchMethodException : Could not find a suitable constructor in ... class.](#problem-1-nosuchmethodexception-could-not-find-a-suitable-constructor-in-class)
      * [Problem 2 -  Unit tests are failing due to the java.lang.ClassNotFoundException](#problem-2-unit-tests-are-failing-due-to-the-javalangclassnotfoundexception)
      * [Problem 3 -  org.apache.wink.common.internal.UriBuilderImpl does not define](#problem-3-orgapachewinkcommoninternaluribuilderimpl-does-not-define)
      * [Problem 4 -  How to make sure that plugin endpoint works on REST v2 ?](#problem-4-how-to-make-sure-that-plugin-endpoint-works-on-rest-v2-)
      * [Problem 5 - InvalidDefinitionException: Cannot construct instance of â€¦ (no Creators, like default constructor, exist)](#problem-5-invaliddefinitionexception-cannot-construct-instance-of-no-creators-like-default-constructor-exist)
      * [Problem 6 - Detected an error (BundleException) enabling the plugin](#problem-6-detected-an-error-bundleexception-enabling-the-plugin)
      * [Problem 7 - Class com.sun.jersey.wadl.resourcedoc.ResourceDocletJSON is not a valid doclet](#problem-7-class-comsunjerseywadlresourcedocresourcedocletjson-is-not-a-valid-doclet)
      * [Problem 8 - Annotation not working as intended](#problem-8-annotation-not-working-as-intended)
      * [Problem 9 - NoSuchMethodException: Could not find a suitable constructor](#problem-9-nosuchmethodexception-could-not-find-a-suitable-constructor)
      * [Problem 10 - Clash Jackson dependencies](#problem-10-clash-jackson-dependencies)
      * [Problem 11 - Spring bean inject not working properly, there are multiple implementations implementations of an interface (on Java)](#problem-11-spring-bean-inject-not-working-properly-there-are-multiple-implementations-implementations-of-an-interface-on-java)
      * [Problem 12 -  Problem - Joda date/time type org.joda.time.DateTime not supported by default](#problem-12-problem-joda-datetime-type-orgjodatimedatetime-not-supported-by-default)
<!-- TOC -->

# REST v2 Migration Guide

## Migration steps
The following table outlines the steps for migrating a plugin to REST v2.
If a component has multiple plugins, it is recommended to migrate each plugin one by one and verify the migration to reduce confusion.

|     | Step                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | REST v1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | REST v2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|-----|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1.  | <h4><b>Migrate to Platform 7</b></h4><p>1. If the component is using Platform to manage dependencies, it is recommended to migrate to Platform 7.</p><p>2. Replace old Platform dependencies with platform 7 dependencies</p><p>3. Donâ€™t forget to change the version of the Platform</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Old Platform usage example<br/> <pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.platform&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;platform&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${platform.version}&lt;/version&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;type&gt;pom&lt;/type&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;import&lt;/scope&gt;<br/>&lt;/dependency&gt;<br/>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.platform&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;third-party&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${platform.version}&lt;/version&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;type&gt;pom&lt;/type&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;import&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre>                                                                        | Use Platform 7 <pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.platform.dependencies&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;platform-public-api&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${platform7.version}&lt;/version&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;type&gt;pom&lt;/type&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;import&lt;/scope&gt;<br/>&lt;/dependency&gt;<br/>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.platform.dependencies&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;platform-test-resources&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${platform7.version}&lt;/version&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;type&gt;pom&lt;/type&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;import&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre>                                                                                                                                                                                                                                                                                                          |
| 2.  | <h4><b>Add rest v2 migration tag to atlassian-plugin.xml</b></h4> <p>1. Identify the atlassian-plugin.xml file that contains the <rest> module descriptor in the plugin.</p><p>2. Add below migration tag to the atlassian-plugin.xml</p><pre><code>&lt;rest-migration key="rest-migration-key"&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;rest-v2/&gt;<br/>&lt;/rest-migration&gt;</code></pre></p><p>3. One atlassian-plugin.xml file only needs to have one migration tag added. In other words, when the migration tag is added, all the REST endpoints defined in atlassian-plugin.xml need to be migrated to REST v2.</p><p>4. The tag is optional and obsolete for plugins running on Platform 7 based products. All plugins will be linked with REST v2 regardless of migration tag presence.</p> | <pre><code>&lt;atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.name}" pluginsVersion="2"&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugin-info&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;description&gt;${project.description}&lt;/description&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${project.version}&lt;/version&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;vendor name="${project.organization.name}" url="${project.organization.url}"/&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugin-info&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;rest key="sample-helloworld" path="/hw" version="2"/&gt;<br/>&lt;/atlassian-plugin&gt;</code></pre>                                                                                                                                                                                                                             | <pre><code>&lt;atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.name}" pluginsVersion="2"&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugin-info&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;description&gt;${project.description}&lt;/description&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${project.version}&lt;/version&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;vendor name="${project.organization.name}" url="${project.organization.url}"/&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugin-info&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--add below rest v2 migration tag to enable rest v2--&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;rest-migration key="rest-migration-key"&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;rest-v2/&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/rest-migration&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;rest key="sample-helloworld" path="/hw" version="2"/&gt;<br/>&lt;/atlassian-plugin&gt;</code></pre>                                                                                                                                                                                                 |
| 3.  | <h4><b>Add @Inject to the constructor of the resource and provider classes</b></h4> <p>1. Add javax.inject to the pom.xml if it's not already present.</p><pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;jakarta.inject&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jakarta.inject-api&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre></p><p>2. Identify the classes that are annotated with @Path or @Provider annotations</p><p>3. Add @Inject to the constructor so that the beans can be injected.</p>                                                                                                                                                                     | <pre><code>@Path("/hello")<br/>public class HelloWorld {<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;private final UserManager userManager;<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;public HelloWorld(UserManager userManager) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.userManager = userManager;<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;@GET<br/>&nbsp;&nbsp;&nbsp;&nbsp;@UnrestrictedAccess<br/>&nbsp;&nbsp;&nbsp;&nbsp;public String hello() {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "HELLO";<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/>}</code></pre>                                                                                                                                                                                                                                                                                                                                                                 | <pre><code>import javax.inject.Inject;<br/><br/>@Path("/hello")<br/>public class HelloWorld {<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;private final UserManager userManager;<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;// Add @Inject to inject bean to the resource class<br/>&nbsp;&nbsp;&nbsp;&nbsp;@Inject<br/>&nbsp;&nbsp;&nbsp;&nbsp;public HelloWorld(UserManager userManager) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.userManager = userManager;<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;@GET<br/>&nbsp;&nbsp;&nbsp;&nbsp;@UnrestrictedAccess<br/>&nbsp;&nbsp;&nbsp;&nbsp;public String hello() {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "HELLO";<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/>}</code></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 4.  | <h4><b>Migrate REST dependency</b></h4> <p>1. Go to pom.xml</p><p>2. Replace atlassian-rest-common with atlassian-rest-v2-api</p><p>3. Idealy the version should be managed by the Platform 7, which is atlassian-rest 8.0.x</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Replace `atlassian-rest-common`<br/> <pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.plugins.rest&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;atlassian-rest-common&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre><br/> Remove `atlassian-rest-module` from the pom as well if it is used in the plugin.<br/>Clean-up:<br/>Remove `com.atlassian.jersey-library`<br/><pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.plugins.rest&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;com.atlassian.jersey-library&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${rest.version}&lt;/version&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;type&gt;pom&lt;/type&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;import&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre> | Use `atlassian-rest-v2-api` with `provided` scope<br/><pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.plugins.rest&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;atlassian-rest-v2-api&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre><br/>t is recommended to run `mvn dependency:tree` to verify if `atlassian-rest-common` is being used in any other dependencies. If it appears in any, exclude it from them.<br/>Clean-up:<br/>Replacement of `com.atlassian.jersey-library`, use `platform-test-resources` as alternative, add manual add missing test dependencies.<br/><pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.platform.dependencies&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;platform-test-resources&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${platform7.version}&lt;/version&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;type&gt;pom&lt;/type&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;import&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre><br/>Then manually import missing test dependencies |
| 5.  | <h4><b>Migrate JAX-RS from</b></h4> <p>Migrate JAX-RS from 1.x to 2.x</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | <pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;javax.ws.rs&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jsr311-api&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;jakarta.ws.rs&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jakarta.ws.rs-api&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 6.  | <h4><b>Migrate Jersey</b></h4> Remove Jersey 1 dependencies from the plugin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `jersey 1.x` package `com.sun.jersey`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <p>- Jersey is not exported from REST v2 anymore</p><p>- jersey 2.x package org.glassfish.jersey but plugin shouldnâ€™t use Jersey directly in the production code. (exclude tests, Jersey Client may use in tests)</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 7.  | <h4><b>Migrate Jackson</b></h4> <p>1. Remove Jackson 1 dependencies from the plugin</p><p>2. Use Jackson 2 as alternative</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | <b>Jackson replacement</b><p>1. jackson-core-asl to jackson-annotations</p><pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jackson-core-asl&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre><p>2. jackson-mapper-asl to jackson-databind</p><pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jackson-mapper-asl&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre><br/><b>Note</b><br/> jackson 1.x package org.codehaus.jackson                                                                                                                                                             | <b>Jackson replacement</b> <p>1. jackson-annotations</p> <pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre><p>2. jackson-databind</p><pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre><b>Note</b></p><p>- jackson 2.x package com.fasterxml.jackson</p><p>- Jackson is not exported from REST v2 anymore</p><p>- Jackson 2 should be used as alternative and provided by the products</p><p>- The scope of the dependency should use provided. Otherwise, for example, com.fasterxml.jackson.annotation wonâ€™t be recognized.</p>                                                                                                                                                                                |
| 8.  | <h4><b>Modify Import-Package</b></h4> <p>1. Identify the <Import-Package> of the amps-maven-plugin in the plugin pom.xml</p><p>2. Ensure that the new added packages are imported if the wildcard (*) is not used.</p><p>3. Replace the packages of REST v1, Jersey 1, and Jackson 1 if they are explicitly specified</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 9.  | <h4><b>Migrate features</b></h4>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Please refer to the table below for more information of each feature                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 10. | <h4><b>Unit test</b></h4>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | You may found Jersey 1 is used in the unit test as a client, it is recommended to use `javax.ws.rs.client.ClientBuilder` from the artifact `jakarta.ws.rs-api`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 11. | <h4><b>Integration test</b></h4> <p>1. The integration tests should be conducted against the product that is already bundled with REST v2 and compatible with Platform 7.</p><p>2. You may need to override or explicitly define the version of the product</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Integration tests should be tested against Platform 7 compatible products which host REST v2.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

## Features breakdown

### Basic features

| Feature                                                              | Migration steps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|----------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Module configuration in the plugin descriptor - atlassian-plugin.xml | <ul><li>rest tag configuration is the same as in REST v1, practical example:`<rest key="sample-filter" path="/filter" version="1"/>`</li><li>To start using REST v2 the rest-migration tag need to be added to atlassian-plugin.xml: `<rest-migration key="rest-migration-key"><rest-v2/></rest-migration>`</li><li>rest-migration tag is optional and obsolete for plugins running on Platform 7 based products</li><li>Entire atlassian-plugin.xml file with rest-migration tag example: [atlassian-rest-v2-sample-helloworld](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-helloworld/src/main/resources/atlassian-plugin.xml#lines-8:10)</li></ul> |                                                                                                                                                                                                                                                                                                                     |
| Providers and Resources scanning                                     | The same functionality as in REST v1 - REST v2 scans and registers the classes with `@Provider` and `@Path` annotations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| JAX-RS(Jakarta RESTful Web Services) annotations supportability      | The same functionality as in REST v1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Response format - JSON or XML                                        | The same functionality as in REST v1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Interceptors                                                         | Interceptor migration guide: [REST v2 Interceptor and execution order migration guide](#markdown-header-rest-v2-interceptor-and-execution-order-migration-guide)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Filters                                                              | Filter migration guide: [REST v2 Filter and execution order migration guide](#markdown-header-rest-v2-filter-and-execution-order-migration-guide)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Dependency Injection                                                 | In REST v2 `@javax.inject.Inject` annotation is required to inject beans in the resource                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Logging message in Jersey                                            | The same functionality as in REST v1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |


### Security features

| Feature                                  | Migration steps                                                                                         |
|------------------------------------------|---------------------------------------------------------------------------------------------------------|
| Security-related annotations and filters | [REST v2 security features migration guide](#markdown-header-rest-v2-security-features-migration-guide) |
| Websudo                                  | The same functionality as in REST v1                                                                    |


### Advanced features

| Feature                 | Migration steps                                                                                                     |
|-------------------------|---------------------------------------------------------------------------------------------------------------------|
| Expansion               | [REST v2 expansion migration guide](#markdown-header-rest-v2-expansion-migration-guide)                             |
| Multipart               | The same functionality as in REST v1                                                                                |
| Requires Dark Feature   | The same functionality as in REST v1                                                                                |
| Scope check             | REST v2 does not support scope check as the `ScopeManager` and `ScopeAware` are deprecated                          |
| Transaction Interceptor | [REST v2 Transaction Interceptor migration guide](#markdown-header-rest-v2-transaction-interceptor-migration-guide) |
| Validation Interceptor  | [REST v2 Validation Interceptor migration guide](#markdown-header-rest-v2-validation-interceptor-migration-guide)   |

### Miscellaneous

| Feature                                            | Migration steps                                                                                                                                                                                                                                                                                                                                                         |
|----------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| JaxbJsonMarshaller                                 | [JaxbJsonMarshaller](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-api/src/main/java/com/atlassian/plugins/rest/api/json/JaxbJsonMarshaller.java) interface is exported as osgi service, therefore it can be imported through `atlassian-spring-scanner` (e.g. using `@ComponentImport` or `importAsOsgiService()`) |
| RestUrlBuilder                                     | [REST v2 RestUrlBuilder migration guide](#markdown-header-rest-v2-resturlbuilder-migration-guide)                                                                                                                                                                                                                                                                       |
| REST Request with entity marshalling functionality | Will be introduced in atlassian-rest 8.0.x                                                                                                                                                                                                                                                                                                                              |
| Documentation generation                           | Will be decided in atlassian-rest 8.0.x                                                                                                                                                                                                                                                                                                                                 |
| Sample plugins modules                             | [atlassian-rest-v2-samples](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-samples/)                                                                                                                                                                                                                                 |


### REST v2 plugin samples

| Sample repository link                                                                                                                                                                                | Sample short description                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
| [atlassian-rest-v2-sample-helloworld](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-helloworld/)                 | Hello World Sample for Atlassian REST v2                   |
| [atlassian-rest-v2-sample-annotation](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-annotation/)                 | Annotation sample for Atlassian REST v2                    |
| [atlassian-rest-v2-sample-interceptor](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-interceptor/)               | Interceptor Sample for Atlassian REST v2                   |
| [atlassian-rest-v2-sample-filter](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-filter/)                         | Filter Sample for Atlassian REST v2                        |
| [atlassian-rest-v2-sample-entity-marshalling](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-entity-marshalling/) | Entity marshalling and unmarshalling for Atlassian REST v2 |
| [atlassian-rest-v2-sample-security](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-security/)                     | Security Sample for Atlassian REST v2                      |
| [atlassian-rest-v2-sample-multipart](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-multipart/)                   | Multipart Sample for Atlassian REST v2                     |
| [atlassian-rest-v2-sample-expansion](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-expansion/)                   | Expansion Sample for Atlassian REST v2                     |
| [atlassian-rest-v2-sample-util](https://bitbucket.org/atlassian/atlassian-rest/src/7.2.x/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-util/)                             | Util Sample for Atlassian REST v2                          |


## Details on Feature Migration

### REST v2 Interceptor and execution order migration guide
#### Breaking changes
From REST v2 (atlassian-rest 8.0.x) onwards, Atlassian REST will no longer support the `ResourceInterceptor` interface and `InterceptorChain` annotation, both of which were previously used to implement `Interceptors` and bind interceptors to resource methods and define their execution order.  
Instead, it will transition to utilizing JAX-RS-provided Interceptors and the `Priority` annotation from the Javax Annotation API.

#### Migration guide for interceptors and execution order

1. ##### Identify existing `ResourceInterceptor` implementations
Start by identifying all classes in your codebase that implement the ResourceInterceptor interface. These will need to be replaced by JAX-RS [ReaderInterceptor](https://jakartaee.github.io/rest/apidocs/2.1.6/javax/ws/rs/ext/ReaderInterceptor.html) or [WriterInterceptor](https://jakartaee.github.io/rest/apidocs/2.1.6/javax/ws/rs/ext/WriterInterceptor.html).

2. ##### Implement JAX-RS Interceptors
For each ResourceInterceptor implementation, create a new class that implements the `javax.ws.rs.ext.ReaderInterceptor` or `javax.ws.rs.ext.WriterInterceptor` interface (or both, depending on your needs).

3. ##### Migrate existing logic in interceptor and add Priority
Move the logic from your `ResourceInterceptor` implementations to the JAX-RS Interceptors.
In the Interceptors class, incorporate the `@Priority` along with the provided integer number to determine the order of execution. The entity interceptors (`ReaderInterceptor`, `WriterInterceptor`) are sorted based on the priority in an ascending manner. For a more in-depth understanding, please read the official Priorities documentation.
The values between `Priorities.AUTHENTICATION` (1000) and `Priorities.USER` (5000) are reserved for system use. The values less than 1000 and greater than 5000 can be used for application-defined interceptors. However, you're free to use any integer values, and you're not limited to these constants.
By default, when the `@Priority` annotation is absent on a component, the `Priorities.USER` (5000) priority value is used.

4. ##### Bind Interceptors with the resource method
Remove the usage of `@InterceptorChain` usage on the resource class. There are two ways to bind Interceptors with the resource, [Name Binding](https://eclipse-ee4j.github.io/jersey.github.io/documentation/2.40/filters-and-interceptors.html#d0e10099) and [Dynamic Binding](https://eclipse-ee4j.github.io/jersey.github.io/documentation/2.40/filters-and-interceptors.html#d0e10172). 
Use the `@Provider` annotation on the class to enable Atlassian REST v2 to scan the interceptors when using Name Binding or the implementation of `javax.ws.rs.container.DynamicFeature` when using Dynamic Binding. Check the `atlassian-rest-v2-sample-interceptor` module for each usage example.

### REST v2 Filter and execution order migration guide

#### Breaking changes
From REST v2 (atlassian-rest 8.0.x) onwards, Atlassian REST will only support REST v2 which is using JAX-RS 2.x and Jersey 2.x.

JAX-RS 2.x introduced filter functionalities which previously were supported directly by Jersey 1.x.

In JAX-RS 2.x and Jersey 2.x there is no more `com.sun.jersey.spi.container.ResourceFilterFactory` and `com.sun.jersey.spi.container.ResourceFilters` annotation:
* ResourceFilterFactory is replaced by Dynamic Feature functionality
* ResourceFilters annotation is replaced by the Name Binding or Dynamic Feature functionality.

A detailed comparison of those differences is provided in the following document.

#### Filter differences between REST v1 and REST v2

| Difference      | Atlassian REST v1                                                                                                                                                                                                                                                                                                                                               | Atlassian REST v2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|-----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Usage           | There are 3 ways to bind filters with the resource method:<br/>1. Filters are registered and executed for all resource methods, in other words globally.<br/>2. Filters are registered and executed for selected resource methods:<br/>a. `com.sun.jersey.spi.container.ResourceFilters` annotation<br/>b. `com.sun.jersey.spi.container.ResourceFilterFactory` | There are 3 ways to bind filters with the resource method:<br/>1. Filters are registered and executed for all resource methods, in other words globally.<br/>2. Filters are registered and executed for selected resource methods:<br/>a. Name Binding concept<br/>b. Dynamic Binding concept<br/>`@Provider` annotation is used to register filer.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Execution order | The execution order of filters is determined by the registration order.                                                                                                                                                                                                                                                                                         | The execution order of filters is determined by the value of the javax.annotation.Priority annotation applied to the filter class.<br/>JAX-RS filters and interceptors are grouped in chains for each of the message processing extension points: Pre, PreMatch, Post as well as ReadFrom and WriteTo.<br/>All chains, except Post, are sorted in ascending order; the lower the number the higher the priority. The Post filter chain is sorted in descending order to ensure that response filters are executed in reverse order.<br/>The values between `Priorities.AUTHENTICATION` (1000) and `Priorities.USER` (5000) are reserved for system use. The values less than 1000 and greater than 5000 can be used for application-defined interceptors. However, you're free to use any integer values, and you're not limited to these constants. <br/>By default, when the `@Priority` annotation is absent on a component, the `Priorities.USER` (5000) priority value is used. |

#### Detailed comparison of filters between REST v1 and REST v2

| Difference                                                                                                                                                                                                                                                                                       | Atlassian REST v1                                                                                                                                                                                                                                                                              | Atlassian REST v2                                                                                                                                                                                                                                                                                                                                                             |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `ContainerRequestFilter`<br/>- Interface name is the same in both versions<br/>- API has changed, but provides very similar functionality<br/>- In REST v1 `ContainerRequestFilter` is provided by Jersey 1.x and in REST v2 `ContainerRequestFilter` is provided by JAX-RS 2.x specification    | `com.sun.jersey.spi.container.ContainerRequestFilter`<br/><pre><code>package com.sun.jersey.spi.container;<br/><br/>public interface ContainerRequestFilter {<br/>&nbsp;&nbsp;&nbsp;&nbsp;ContainerRequest filter(ContainerRequest request);<br/>}</code></pre>                                | `javax.ws.rs.container.ContainerRequestFilter`<br/><pre><code>package javax.ws.rs.container;<br/><br/>public interface ContainerRequestFilter {<br/>&nbsp;&nbsp;&nbsp;&nbsp;public void filter(ContainerRequestContext requestContext) throws IOException;<br/>}</code></pre>                                                                                                 |
| `ContainerResponseFilter`<br/>- Interface name is the same in both versions<br/>- API has changed, but provides very similar functionality<br/>- In REST v1 `ContainerResponseFilter` is provided by Jersey 1.x and in REST v2 `ContainerResponseFilter` is provided by JAX-RS 2.x specification | `com.sun.jersey.spi.container.ContainerResponseFilter`<br/><pre><code>package com.sun.jersey.spi.container;<br/><br/>public interface ContainerResponseFilter {<br/>&nbsp;&nbsp;&nbsp;&nbsp;ContainerResponse filter(ContainerRequest request, ContainerResponse response);<br/>}</code></pre> | `javax.ws.rs.container.ContainerResponseFilter`<br/><pre><code>package javax.ws.rs.container;<br/><br/>public interface ContainerResponseFilter {<br/>&nbsp;&nbsp;&nbsp;&nbsp;public void filter(ContainerRequestContext requestContext, ContainerResponseContext responseContext)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws IOException;<br/>}</code></pre> |
| `ResourceFilters` annotation replaced by Name Binding or Dynamic Binding functionality                                                                                                                                                                                                           | - `com.sun.jersey.spi.container.ResourceFilters annotation`<br/>- `com.sun.jersey.spi.container.ResourceFilter`                                                                                                                                                                                | Name Binding or Dynamic Binding functionality:<br/>- `javax.ws.rs.NameBinding annotation`<br/>- `javax.ws.rs.container.DynamicFeature`                                                                                                                                                                                                                                        |
| `ResourceFilterFactory` replaced by `DynamicFeature`                                                                                                                                                                                                                                             | -`com.sun.jersey.spi.container.ResourceFilterFactory`<br/>- `com.sun.jersey.spi.container.ResourceFilter`                                                                                                                                                                                      | - `javax.ws.rs.container.DynamicFeature`                                                                                                                                                                                                                                                                                                                                      |
                                            
#### ResourceFilterFactory replaced by DynamicFeature
`ResourceFilterFactory` is replaced by `DynamicFeature` functionality.

##### Practical example
Jersey 1 vs Jersey 2 - comparison of the implementation of the same filter.

The same filter is implemented in Jersey 1 and Jersey 2. Both filters provide capability for allowing roles for users by checking annotations on the resource method.

This comparison may be very useful for developers when migrating from REST v1 to REST v2 as it is easier to understand the differences when comparing both filters side by side.

In below table first column contains implementation of the `RolesAllowedResourceFilterFactory` and Filter from Jersey 1. Second column contains implementation of the `RolesAllowedDynamicFeature` and `RolesAllowedRequestFilte`r.
       
| RolesAllowed filter - Jersey 1 (ResourceFilterFactory and ResourceFilter)                                                                                                                                 | RolesAllowed filter - Jersey 2 (DynamicFeature)                                                                                                                                         |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Source: [RolesAllowedResourceFilterFactory.java](https://github.com/javaee/jersey-1.x/blob/master/jersey-server/src/main/java/com/sun/jersey/api/container/filter/RolesAllowedResourceFilterFactory.java) | Source: [RolesAllowedDynamicFeature.java](https://github.com/eclipse-ee4j/jersey/blob/2.x/core-server/src/main/java/org/glassfish/jersey/server/filter/RolesAllowedDynamicFeature.java) |

#### ResourceFilters annotation replaced by Name Binding or Dynamic Binding
`com.sun.jersey.spi.container.ResourceFilters` annotation can be replaced by the Name Binding or Dynamic Binding functionality.

Below table compares REST v1 ResourceFilters annotation and REST v2 Name Binding and Dynamic Binding functionality.

|                       | Atlassian REST v1 - ResourceFilters annotation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Atlassian REST v2 - Name Binding                                                                                                                                                                                                                                                                                                                                                                                  | REST v2 - Dynamic Binding                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Resource method       | <pre><code>@Path("/admin/user")<br/>@ResourceFilters({AdminOnlyResourceFilter.class})<br/>public final class AdminUserResource {<br/>&nbsp;&nbsp;&nbsp;&nbsp;// ...<br/>&nbsp;&nbsp;&nbsp;&nbsp;// some resource method<br/>}</code></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | <pre><code>@Path("/filterNameBinding")<br/>@FilterNameBinding1<br/>public class FilterNameBindingResource {<br/>&nbsp;&nbsp;&nbsp;&nbsp;// ...<br/>&nbsp;&nbsp;&nbsp;&nbsp;// some resource method<br/>}</code></pre>                                                                                                                                                                                             | <pre><code>@Path("/filterDynamicBinding")<br/>@FilterDynamicBinding({ ContainerRequestDynamicBindingFilter1.class })<br/>public class FilterDynamicBindingResource {<br/>&nbsp;&nbsp;&nbsp;&nbsp;// ...<br/>&nbsp;&nbsp;&nbsp;&nbsp;// some resource method<br/>}</code></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Filter implementation | <pre><code>@Provider<br/>public class AdminOnlyResourceFilter implements ResourceFilter, ContainerRequestFilter {<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;@Override<br/>&nbsp;&nbsp;&nbsp;&nbsp;public ContainerRequest filter(final ContainerRequest containerRequest) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// filter logic<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;// -----------------<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;// Filter in order to be used with <br/>&nbsp;&nbsp;&nbsp;&nbsp;// @ResourceFilters in the AdminUserResource<br/>&nbsp;&nbsp;&nbsp;&nbsp;// have to implement ResourceFilter interface<br/>&nbsp;&nbsp;&nbsp;&nbsp;// <br/>&nbsp;&nbsp;&nbsp;&nbsp;@Override<br/>&nbsp;&nbsp;&nbsp;&nbsp;public ContainerRequestFilter getRequestFilter() {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;<br/>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;@Override<br/>&nbsp;&nbsp;&nbsp;&nbsp;public ContainerResponseFilter getResponseFilter() {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return null;<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/>}</code></pre> | <pre><code>@Priority(5800)<br/>@Provider<br/>@FilterNameBinding1<br/>public class ContainerRequestNameBindingFilter1 implements ContainerRequestFilter {<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;@Override<br/>&nbsp;&nbsp;&nbsp;&nbsp;public void filter(ContainerRequestContext requestContext) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// filter logic<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/>}</code></pre> | <pre><code>@Priority(5800)<br/>public class ContainerRequestDynamicBindingFilter1 implements ContainerRequestFilter {<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;@Override<br/>&nbsp;&nbsp;&nbsp;&nbsp;public void filter(ContainerRequestContext requestContext) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// filter logic<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/>}</code></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Additional logic      | No additional logic is required.<br/>`@ResourceFilters` annotation is provided the Jersey 1.x, (`com.sun.jersey.spi.container.ResourceFilters`).<br/>It is scanned by `com.sun.jersey.server.impl.container.filter.AnnotationResourceFilterFactory`.<br/>It is registered by `com.sun.jersey.server.impl.container.filter.FilterFactory`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | <pre><code>@NameBinding<br/>@Retention(RetentionPolicy.RUNTIME)<br/>public @interface FilterNameBinding1 {<br/><br/>}</code></pre>                                                                                                                                                                                                                                                                                | <pre><code>@Retention(RetentionPolicy.RUNTIME)<br/>@Target({ElementType.TYPE, ElementType.METHOD})<br/>public @interface FilterDynamicBinding {<br/>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&gt;[] value();<br/>}</code></pre><br/><pre><code>@Provider<br/>public class FilterDynamicBindingFeature implements DynamicFeature {<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;@Override<br/>&nbsp;&nbsp;&nbsp;&nbsp;public void configure(ResourceInfo resourceInfo, FeatureContext context) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;registerFilters(resourceInfo.getResourceMethod()<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.getAnnotation(FilterDynamicBinding.class), context);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;registerFilters(resourceInfo.getResourceClass()<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.getAnnotation(FilterDynamicBinding.class), context);<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;private void registerFilters(FilterDynamicBinding annotation, FeatureContext context) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (annotation != null) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stream.of(annotation.value())<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.forEach(context::register);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/>}</code></pre> |
         
#### Access-related annotations (SystemAdmin and AdminOnly)
                                  
[SysadminOnlyResourceFilter.java](https://bitbucket.org/atlassian/atlassian-rest/src/atlassian-rest-parent-7.1.7/atlassian-rest-base/atlassian-rest-common/src/main/java/com/atlassian/plugins/rest/common/security/jersey/SysadminOnlyResourceFilter.java) and [AdminOnlyResourceFilter.java](https://bitbucket.org/atlassian/atlassian-rest/src/atlassian-rest-parent-7.1.7/atlassian-rest-base/atlassian-rest-common/src/main/java/com/atlassian/plugins/rest/common/security/jersey/AdminOnlyResourceFilter.java) are deprecated in REST v1.
* In REST v1 `SysadminOnlyResourceFilter` should be replaced by [SystemAdminOnly.java](https://bitbucket.org/atlassian/atlassian-rest/src/atlassian-rest-parent-7.1.7/atlassian-rest-base/atlassian-rest-common/src/main/java/com/atlassian/plugins/rest/common/security/SystemAdminOnly.java) annotation.
* In REST v1 `AdminOnlyResourceFilter` should be replaced by [AdminOnly.java](https://bitbucket.org/atlassian/atlassian-rest/src/atlassian-rest-parent-7.1.7/atlassian-rest-base/atlassian-rest-common/src/main/java/com/atlassian/plugins/rest/common/security/AdminOnly.java) annotation.


### REST v2 security features migration guide
#### Authentication Check

| Class                                                                                                                                                                             | Atlassian REST v1                                                                                 | Atlassian REST v2                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Annotations:<br/>`@AdminOnly`<br/>`@AnonymousSiteAccess`<br/>`@LicensedOnly`<br/>`@SystemAdminOnly`<br/>`@UnlicensedSiteAccess`<br/>`@UnrestrictedAccess`<br/>`@AnonymousAllowed` | Package in v1: `com.atlassian.plugins.rest.common.security`<br/>Artifact: `atlassian-rest-common` | Package changed in v2: `com.atlassian.plugins.rest.api.security.annotation`<br/>Artifact: `atlassian-rest-v2-api`<br/><br/>Remove deprecated `@AnonymousAllowed` annotation in v2:<br/>Replacement: <br/>- Use `AnonymousSiteAccess` where resourceis intended to be accessible to anonymous users, only when site has anonymous user access enabled. <br/>- Use `UnrestrictedAccess` if resource should be accessible to all users irrespective of any other factor. |
| Exception:<br/>`AuthenticationRequiredException`                                                                                                                                  | Package in v1: `com.atlassian.plugins.rest.common.security`<br/>Artifact: `atlassian-rest-common` | Package changed in v2: `com.atlassian.plugins.rest.api.security.exception`<br/>Artifact: `atlassian-rest-v2-api`                                                                                                                                                                                                                                                                                                                                                      |   
| Exception:<br/>`AuthorisationException`                                                                                                                                           | Package in v1: `com.atlassian.plugins.rest.common.security`<br/>Artifact: `atlassian-rest-common` | Removed in v2, please use `AuthenticationRequiredException`                                                                                                                                                                                                                                                                                                                                                                                                           | 


#### Cross-Site Request Forgery (XSRF) Protection

| Class                                     | Atlassian REST v1                                                                                 | Atlassian REST v2                                                                                                |
|-------------------------------------------|---------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------|
| Annotation:<br/>`@RequiresXsrfCheck`      | Package in v1: `com.atlassian.plugins.rest.common.security`<br/>Artifact: `atlassian-rest-common` | Removed deprecated `@RequiresXsrfCheck` annotation in v2. By default the XSRF check is enabled.                  |
| Annotation:<br/>`@XsrfProtectionExcluded` | Package in v1: `com.atlassian.annotations.security`<br/>Artifact: `atlassian-annotations`         | Package in v2 is the same: `com.atlassian.annotations.security`<br/>Artifact: `atlassian-annotations`            |
| Exception:<br/>`XsrfCheckFailedException` | Package in v1: `com.atlassian.plugins.rest.common.security`<br/>Artifact: `atlassian-rest-common` | Package changed in v2: `com.atlassian.plugins.rest.api.security.exception`<br/>Artifact: `atlassian-rest-v2-api` |


#### Cross-Origin Resource Sharing (CORS) Check

| Class                                                | Atlassian REST v1                                                                                            | Atlassian REST v2                                                                                                                                              |
|------------------------------------------------------|--------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Annotation:<br/>`@CorsAllowed`                       | Package in v1: `com.atlassian.plugins.rest.common.security`<br/>Artifact: `atlassian-rest-common`            | Package changed in v2: `com.atlassian.plugins.rest.api.security.annotation`<br/>Artifact: `atlassian-rest-v2-api`                                              |
| Interface:<br/>`CorsDefaults`                        | Package in v1: `com.atlassian.plugins.rest.common.security.descriptor`<br/>Artifact: `atlassian-rest-common` | Atlassian internal use only!<br/>Package changed in v2: `com.atlassian.plugins.rest.api.internal.security.cors`<br/>Artifact: `atlassian-rest-v2-internal-api` |
| Enum:<br/>`CorsHeaders`                              | Package in v1: `com.atlassian.plugins.rest.common.security`<br/>Artifact: `atlassian-rest-common`            | Atlassian internal use only!<br/>Package changed in v2: `com.atlassian.plugins.rest.api.internal.security.cors`<br/>Artifact: `atlassian-rest-v2-internal-api` |
| Exception:<br/>`CorsPreflightCheckCompleteException` | Package in v1: `com.atlassian.plugins.rest.common.security`<br/>Artifact: `atlassian-rest-common`            | Removed in REST v2. It was only used to abort the request in the filter. In REST v2, `requestContext.abortWith(response)` can be used to achieve this.         |
                                                                                                                                                                         
#### Anti-sniffing Protection
No change. The same functionality as in REST v1.

#### Web Sudo Check
                                                                                                                                                                                                                                                                   
| Class                                     | Atlassian REST v1                                                                                 | Atlassian REST v2                                                                                                |
|-------------------------------------------|---------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------|
| Exception:<br/>`WebSudoRequiredException` | Package in v1: `com.atlassian.plugins.rest.common.security`<br/>Artifact: `atlassian-rest-common` | Package changed in v2: `com.atlassian.plugins.rest.api.security.exception`<br/>Artifact: `atlassian-rest-v2-api` |               

#### POJO

| Class                           | Atlassian REST v1                                                                        | Atlassian REST v2                                                                                   |
|---------------------------------|------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Models:<br/>`Link`<br/>`Status` | Package in v1: `com.atlassian.plugins.rest.common`<br/>Artifact: `atlassian-rest-common` | Package changed in v2: `com.atlassian.plugins.rest.api.model`<br/>Artifact: `atlassian-rest-v2-api` |

#### Authentication context
AuthenticationContext is no longer supported by REST v2.

| Security Feature       | REST v1                                                                                                                                            | REST v2                                                             |
|------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
| Authentication Context | Package in v1: <br/>`com.atlassian.plugins.rest.common.security`<br/>Class:<br/>`AuthenticationContext`<br/>Artifact: <br/>`atlassian-rest-common` | Use `com.atlassian.sal.api.user.UserManager` from `sal-api` instead |


### REST v2 expansion migration guide

#### Package structure
In Atlassian REST v1 all expansion feature api was located in package: ```com.atlassian.plugins.rest.common.expand```
in library:
```xml
<dependency>
    <groupId>com.atlassian.plugins.rest</groupId>
    <artifactId>atlassian-rest-common</artifactId>
</dependency>
```
However, in REST v2 changed the expansion feature api structure into 3 sub-modules (artifacts). The Expansion Feature API presents as follows:

#### Public API

```xml
<dependency>
    <groupId>com.atlassian.plugins.rest</groupId>
    <artifactId>atlassian-rest-v2-api</artifactId>
</dependency>
```

The library is accessible by internal products, plugins, and third-party plugins.

The change in package structure looks as following:

| Atlassian REST v1                                                                | Atlassian REST v2                                                                               |
|----------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------|
| ```com.atlassian.plugins.rest.common.expand.EntityCrawler```                     | ```com.atlassian.plugins.rest.api.expand.EntityCrawler```                                       |
| ```com.atlassian.plugins.rest.common.expand.ExpandContext```                     | ```com.atlassian.plugins.rest.api.internal.expand.listwrapper.ListWrapperCallBacks```           |
| ```com.atlassian.plugins.rest.common.expand.ListWrapperEntityExpanderResolver``` | ```com.atlassian.plugins.rest.api.internal.expand.resolver.ListWrapperEntityExpanderResolver``` |
| ```com.atlassian.plugins.rest.common.expand.ChainingExpandParameter```           | ```com.atlassian.plugins.rest.api.internal.expand.parameter.ChainingExpandParameter```          |
| ```com.atlassian.plugins.rest.common.expand.parameter.DefaultExpandParameter```  | ```com.atlassian.plugins.rest.api.internal.expand.parameter.DefaultExpandParameter```           |
| ```com.atlassian.plugins.rest.common.expand.parameter.IndexParser```             | ```com.atlassian.plugins.rest.api.internal.expand.parameter.IndexParser```                      |
| ```com.atlassian.plugins.rest.common.expand.ExpandException```                   | ```com.atlassian.plugins.rest.api.internal.expand.exception.ExpandIndexException```             |
| ```com.atlassian.plugins.rest.common.expand.parameter.IndexException```          | ```com.atlassian.plugins.rest.api.internal.expand.exception.ExpandIndexException```             |

#### Plugin internal API
```xml
<dependency>
    <groupId>com.atlassian.plugins.rest</groupId>
    <artifactId>atlassian-rest-v2-plugin</artifactId>
</dependency>
```
The library should not be used directly in any plugins.

| Atlassian REST v1                                                                                | Atlassian REST v2                                                                            |
|--------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------|
| ```com.atlassian.plugins.rest.common.expand.SelfExpandingEntityExpander```                       | ```com.atlassian.plugins.rest.v2.expand.expander.SelfExpandingExpander```                    |
| ```com.atlassian.plugins.rest.common.expand.interceptor.ExpandInterceptor```                     | ```com.atlassian.plugins.rest.v2.expand.ExpandFilter```                                      |
| ```com.atlassian.plugins.rest.common.expand.resolver.ChainingEntityExpanderResolver```           | ```com.atlassian.plugins.rest.v2.expand.resolver.ChainingEntityExpanderResolver```           |
| ```com.atlassian.plugins.rest.common.expand.resolver.CollectionEntityExpanderResolver```         | ```com.atlassian.plugins.rest.v2.expand.resolver.ListEntityExpanderResolver```               |
| ```com.atlassian.plugins.rest.common.expand.resolver.ExpandConstraintEntityExpanderResolver```   | ```com.atlassian.plugins.rest.v2.expand.resolver.IndexedEntityExpanderResolver```            |
| ```com.atlassian.plugins.rest.common.expand.resolver.ListWrapperEntityExpanderResolver```        | ```com.atlassian.plugins.rest.v2.expand.resolver.ListWrapperEntityExpanderResolver```        |
| ```com.atlassian.plugins.rest.common.expand.resolver.IdentityEntityExpanderResolver```           | ```com.atlassian.plugins.rest.v2.expand.resolver.IdentityEntityExpanderResolver```           |
| ```com.atlassian.plugins.rest.common.expand.resolver.AbstractAnnotationEntityExpanderResolver``` | ```com.atlassian.plugins.rest.v2.expand.resolver.AbstractAnnotationEntityExpanderResolver``` |

#### Removed classes

The following classes have been removed from REST v2 completely:

```com.atlassian.plugins.rest.common.expand.AdditionalExpandsProvider```

```com.atlassian.plugins.rest.common.expand.resolver.AbstractEntityExpanderResolver```

#### Import these classes as OSGi beans

The following interfaces have been reimplemented as beans to not overexpose their implementation classes in API. 
If your product uses the following class/classes, please import their beans, as shown in following examples, and inject using ```@Inject``` annotation
- ```EntityCrawler``` - [import example](https://bitbucket.org/atlassian/atlassian-rest/src/ced06bcdcd940b3b6d1ceeed483eb263b17ea80e/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-expansion/src/main/java/com/atlassian/plugins/rest/sample/v2/expansion/spring/SpringBeans.java#lines-15) 
- ```ListWrapperEntityExpanderResolver``` - [import example ](https://bitbucket.org/atlassian/atlassian-rest/src/ced06bcdcd940b3b6d1ceeed483eb263b17ea80e/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-expansion/src/main/java/com/atlassian/plugins/rest/sample/v2/expansion/spring/SpringBeans.java#lines-20)
- ```SelfExpandingEntityExpanderResolver``` - [import example](https://bitbucket.org/atlassian/atlassian-rest/src/ced06bcdcd940b3b6d1ceeed483eb263b17ea80e/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-expansion/src/main/java/com/atlassian/plugins/rest/sample/v2/expansion/spring/SpringBeans.java#lines-25) 
- [Injection example](https://bitbucket.org/atlassian/atlassian-rest/src/660b91efce689e3f343bcdd79247ab8d86abfc75/atlassian-rest-v2-base/atlassian-rest-v2-samples/atlassian-rest-v2-sample-expansion/src/main/java/com/atlassian/plugins/rest/sample/v2/expansion/entitycrawler/CustomEntityCrawlerResource.java#lines-35) for the above beans

#### Expanding Collection Types is no longer supported

REST v2 no longer supports expansion of `Collection` type fields, REST v2 only supports ```List``` types

##### Specific to Jira
In the ```PagedListWrapper``` change field type of expandable entity items from `Collection` to `List`.


### REST v2 Transaction Interceptor migration guide

#### Breaking changes

As mentioned in [REST v2 Interceptor and execution order migration guide](#markdown-header-rest-v2-interceptor-and-execution-order-migration-guide) from Atlassian REST 8.0 onwards, Atlassian REST will no longer support 
the `ResourceInterceptor` interface and InterceptorChain annotation, both of which are part of REST v1 only and were previously used to implement 
Interceptors such as `TransactionInterceptor`, which will consequently not be supported anymore.

#### Migration guide for TransactionInterceptor

In order to continue using transactions from the resources, replace the usage of `TransactionInterceptor` with SALâ€™s `TransactionTemplate`. 
The `TransactionTemplate` from SAL plugin was used by `TransactionInterceptor`, which ensures the same behavior even after the migration.
Below is a code snippet with a resource migrated from `TransactionInterceptor` to SALâ€™s `TransactionTemplate`:

| Atlassian REST v1 - `TransactionInterceptor`                                                                                                                                                                                                                                                                                                                                                     | Atlassian REST v2 - `TransactionTemplate`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <pre><code>@Path("myresource")<br/>@InterceptorChain(value = {TransactionInterceptor.class})<br/>public class MyResource {<br/>&nbsp;&nbsp;@PUT<br/>&nbsp;&nbsp;@Produces(MediaType.APPLICATION_JSON)<br/>&nbsp;&nbsp;public Response update(MyEntity myEntity) throws Exception {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return updateMyEntity(myEntity);<br/>&nbsp;&nbsp;}<br/>}</code></pre> | <pre><code>@Path("myresource")<br/>public class MyResource {<br/>&nbsp;&nbsp;private final TransactionTemplate transactionTemplate;<br/>&nbsp;&nbsp;@PUT<br/>&nbsp;&nbsp;@Produces(MediaType.APPLICATION_JSON)<br/>&nbsp;&nbsp;public Response update(MyEntity myEntity) throws Exception {<br/>&nbsp;&nbsp;&nbsp;&nbsp;return transactionTemplate.execute(() -> {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return updateMyEntity(myEntity); <br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} catch (Exception e) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new RuntimeException(e);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>&nbsp;&nbsp;&nbsp;&nbsp;});<br/>&nbsp;&nbsp;}<br/>}</code></pre> |

More about SAL: [About SAL development](https://developer.atlassian.com/server/framework/atlassian-sdk/about-sal-development/)

### REST v2 Validation Interceptor migration guide

#### Breaking changes

As mentioned in [REST v2 Interceptor and execution order migration guide](#markdown-header-rest-v2-interceptor-and-execution-order-migration-guide) from version 8.0 onwards,
REST v2 will no longer support the `ResourceInterceptor` interface and `InterceptorChain` annotation, both of which were previously used to implement Interceptors
such as `ValidationInterceptor`, which will consequently not be supported anymore.

#### Migration guide for `ValidationInterceptor`

REST v2 does not provide an option for enabling validation by default. Consider implementing validation by using some dedicated library such as `hibernate-validator`
and configuring your resource to validate entities in the most suitable way for your project.

More about `hibernate-validator`: [Documentation - Hibernate Validator](https://hibernate.org/validator/documentation/)

### REST v2 RestUrlBuilder migration guide
The `RestUrlBuilder` is a utility that allows for the creation of URIs based on the base URI and resource. 
It is provided by REST v2 as an OSGI service, which plugins can import into their code.

#### Package migrations
                               
| Old Maven artifact      | Old Java package                         | New Maven artifact      | New Java package                      | Class            | Notes                                                                                   |
|-------------------------|------------------------------------------|-------------------------|---------------------------------------|------------------|-----------------------------------------------------------------------------------------|
| `atlassian-rest-common` | `com.atlassian.plugins.rest.common.util` | `atlassian-rest-v2-api` | `com.atlassian.plugins.rest.api.util` | `RestUrlBuilder` | Moved to the public API module, user can import the implementation as the OSGI service. |
                                                   
#### Code deprecations
      
| Class name       | Code                                                                                             | Alternative code                                                                | Migration notes                                                                                                                          |
|------------------|--------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------|
| `RestUrlBuilder` | 1. `URI getURI(Response resource)`<br/>2. `<T> T getUrlFor(URI baseUri, Class<T> resourceClass)` | `<T> URI getUrlFor(URI baseUri, Class<T> resourceClass, Consumer<T> consumer);` | The previous implementations were a bit confusing and introduced redundant steps for the users. Therefore, the method has been improved. |

#### Example

##### Atlassian REST v1
1. Import the RestUrlBuilder as an OSGI service
```java
import com.atlassian.plugins.rest.common.util.RestUrlBuilder;

@Configuration
public class SpringBeans { 
    @Bean
    public RestUrlBuilder importRestUrlBuilder() {
        return importOsgiService(RestUrlBuilder.class);
    }
}
``` 

2. If thereâ€™s a resource class like the following:
```java
@Path("/dummy")
public class FooResource {
  @Path("/sub")
  public Response subResource() {
      return null;
  }
}
```

3. The URL for the subresource can be constructed using the REST v1 URL builder:
```java
FooResource resource = urlBuilder.getUrlFor(new URI("http://base2"), FooResource.class);
Response response = resource.subResource();
assertEquals("http://base2/dummy/sub", response.toString());
```

##### Atlassian REST v2
1. Import the RestUrlBuilder as an OSGI service
```java
import com.atlassian.plugins.rest.api.util.RestUrlBuilder;

@Configuration
public class SpringBeans {
    @Bean
    public RestUrlBuilder importRestUrlBuilder() {
        return importOsgiService(RestUrlBuilder.class);
    }
}
```

2. If thereâ€™s a resource class like the following:
```java
@Path("/dummy")
public class FooResource {
  @Path("/sub")
    public Response subResource() {
        return null;
    }
}
```

3. The URL for the subresource can be constructed using the REST v2 URL builder:
```java
URI uri = urlBuilder.getUrlFor(new URI("http://base2"), FooResource.class, FooResource::subResource);
assertEquals("http://base2/dummy/sub", uri.toString());
```

## Common problems and solutions <a name="markdown-header-common-problems-and-solutions"></a>

### Problem 1 - NoSuchMethodException : Could not find a suitable constructor in ... class.

#### Problem

NoSuchMethodException : Could not find a suitable constructor in ... class.<br/>
<pre><code>java.lang.NoSuchMethodException: Could not find a suitable constructor in com.atlassian.healthcheck.core.rest.HealthCheckResource class.<br/>	
at org.glassfish.jersey.inject.hk2.JerseyClassAnalyzer.getConstructor(JerseyClassAnalyzer.java:168)<br/>	...</code></pre>

#### Solution

<p>1. Add javax.inject dependency to the POM, ideally it should be managed by the Platform</p> 
<pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;jakarta.inject&lt;/groupId&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jakarta.inject-api&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>
&lt;/dependency&gt;</code></pre> 

<p>2. Add @Inject annotation to the constructor in the resource class to inject the beans.</p> 
<pre><code>import javax.inject.Inject;<br/>...<br/><br/>@Path("/hello")<br/>
public class HelloWorld {<br/>&nbsp;&nbsp;&nbsp;&nbsp;@Inject // Add @Inject annotation<br/>&nbsp;&nbsp;&nbsp;&nbsp;public HelloWorld(UserManager userManager) {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.userManager = userManager;<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/>}</code></pre>

<p><b>Spring @Autowired annotation clarification</b></p>

<p><b>REST v1:</b></p>

<ul>
    <li>In REST v1 it is possible to use Spring @Autowired annotation or @Autowired annotation could be omitted and Spring will use that constructor and inject all necessary dependencies. More can be found here: <a href="https://stackoverflow.com/questions/41092751/spring-injects-dependencies-in-constructor-without-autowired-annotation">Spring injects dependencies in constructor without @Autowired annotation.</a></li>
</ul>

<p><b>REST v2:</b></p>

<ul>
    <li>The NoSuchMethodException will be thrown if the the resource method is annotated with Spring @Autowired annotation.</li>
    <li>The @Autowired annotation is no longer supported and should be migrated to the @Inject annotation.</li>
    <li>@Autowired is Spring specific and @javax.inject.Inject is part of a standard (Java EE / Jakarta EE - JSR-330). It's better to rely on the standard rather than on the specific implementation. It allows the use of other dependency injection libraries.</li>
    <li>Dependency injection is managed by Jersey and HK2, dependency: org.glassfish.jersey.inject:jersey-hk2.</li>
    <li>@Inject annotation needs to be added, otherwise there will be an exception mentioned in the description of this problem (java.lang.NoSuchMethodException: Could not find a suitable constructor in ... class).</li>
</ul>

### Problem 2 -  Unit tests are failing due to the java.lang.ClassNotFoundException

#### Problem

Unit tests are failing due to the java.lang.ClassNotFoundException: org.glassfish.jersey.internal.RuntimeDelegateImpl.

#### Solution

Add jersey-common to the test scope (it should provide the implementation to jakarta.ws.rs-api) in order to provide the implementation for the unit tests. 
<pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.glassfish.jersey.core&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jersey-common&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;test&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre>

### Problem 3 -  org.apache.wink.common.internal.UriBuilderImpl does not define

#### Problem

org.apache.wink.common.internal.UriBuilderImpl does not define<br/>
<pre><code>java.lang.AbstractMethodError: Receiver class org.apache.wink.common.internal.UriBuilderImpl does not define or inherit an implementation of 
the resolved method 'abstract javax.ws.rs.core.UriBuilder uri(java.lang.String)' of abstract class javax.ws.rs.core.UriBuilder.</code></pre>


#### Solution

<p>This means avax.ws.rs.core.UriBuilder is trying to invoke an abstract method that has not been implemented. 
Apache Wink is an old project and it's not compatible with newer versions of JAX-RS 2.x.</p>
<p>1. use mvn dependency:tree to see which dependency is using Apache Wink, and Jersey 1, atlssian-rest-common</p>
<p>2. exclude those jsr311-api dependencies and Apache Wink, and Jersey 1, atlssian-rest-common</p> 
<pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;javax.ws.rs&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jsr311-api&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;1.1.1&lt;/version&gt;<br/>&lt;/dependency&gt;</code></pre> <p>3. Then use jakarta.ws.rs-api</p> <pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;jakarta.ws.rs&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jakarta.ws.rs-api&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;2.1.6&lt;/version&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre>

### Problem 4 -  How to make sure that plugin endpoint works on REST v2 ?

#### Problem

How to make sure that plugin endpoint works on REST v2 ?<br/> When the plugin you are migrating is successfully installed (UPM shows itâ€™s installed and enabled) 
but still receives a 404 not found error when hitting the endpoint, and thereâ€™s no error in the log.

#### Solution

<p>- Check the plugin in the OSGi tab in the admin panel. <br>
For example in RefApp: <a href="http://localhost:5990/refapp/plugins/servlet/upm/osgi">http://localhost:5990/refapp/plugins/servlet/upm/osgi</a></p>
<p>&emsp;- EXPECTED: Expand the <b>Import-Package</b> section of your plugin should import JAX-RS packages 
with the version should be between [2.0.0,3.0.0) and are provided by <b>REST v2 implementation</b>.</p> 
<p>&emsp;&emsp;- WRONG: Wrong JAX-RS import as the version is between [1.1.1, 1.1.1]</p> 
<p>&emsp;&emsp;&emsp;<b>Solution</b>:</p><p>&emsp;&emsp;&emsp;Check the &lt;Import-Package&gt; in amps-maven-plugin of the plugin. <br>&emsp;&emsp;&emsp;Import javax.ws.rs\*;version="[2.0.0,3.0.0)",</p> 
<p>&emsp;- In the <b>Services in use</b> section, you should see one that is coming from REST v2 plugin as well.</p> 
<p>- Check the &lt;Import-Package&gt; in amps-maven-plugin of the plugin to ensure that you have imported all necessary packages. 
Some plugins may not use wildcard (*) that you need to manually import the required packages.</p>

### Problem 5 - InvalidDefinitionException: Cannot construct instance of â€¦ (no Creators, like default constructor, exist)

#### Problem

<p>InvalidDefinitionException: Cannot construct instance of â€¦ (no Creators, like default constructor, exist)</p><br/>
<pre><code>javax.ws.rs.client.ResponseProcessingException: com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot construct instance of com.atlassian.plugins.rest.sample.v2.marshalling.visibility.NoAnnotationPojo (no Creators, like default constructor, exist): cannot deserialize from Object value (no delegate- or property-based Creator) at &lsqb;Source: (org.glassfish.jersey.message.internal.ReaderInterceptorExecutor$UnCloseableInputStream); line: 1, column: 2&rsqb;</code></pre>

#### Solution

<p>If the class has all-arguments or partial-arguments then the non-arguments constructor is also required.</p>

<p>- EXPECTED: Should add a non-arguments constructor if the class has constructor.</p>
<pre><code>@XmlRootElement<br/>public class XmlRootElementAnnotationOnlyPojo {<br/>&nbsp;&nbsp;&nbsp;&nbsp;public String publicField;<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;public XmlRootElementAnnotationOnlyPojo(String publicField) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.publicField = publicField;<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;// Should have a non-arg constructor<br/>&nbsp;&nbsp;&nbsp;&nbsp;public XmlRootElementAnnotationOnlyPojo() {}<br/>}</code></pre>

<p>- EXPECTED: The non-arguments constructor is not required if the class has no constructor.</p>
<pre><code>public class XmlRootElementAnnotationOnlyPojo {<br/>&nbsp;&nbsp;&nbsp;&nbsp;public String publicField;<br/>}</code></pre> 

<p>- WRONG: No creator or non-arguments constructor</p> 
<pre><code>@XmlRootElement<br/>public class XmlRootElementAnnotationOnlyPojo {<br/>&nbsp;&nbsp;&nbsp;&nbsp;public String publicField;<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;public XmlRootElementAnnotationOnlyPojo(String publicField) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.publicField = publicField;<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;// Should add a non-arguments constructor to solve the issue.<br/>}</code></pre>

### Problem 6 - Detected an error (BundleException) enabling the plugin

#### Problem

<p>Detected an error (BundleException) enabling the plugin </p>
<pre><code>ERROR - 09:45:25,684 - com.atlassian.plugin.osgi.factory.OsgiPlugin - &lsqb;localhost-startStop-1&rsqb; - Detected an error (BundleException) enabling the plugin 'com.atlassian.ratelimiting.rate-limiting-plugin' : Uses constraint violation. Unable to resolve resource com.atlassian.ratelimiting.rate-limiting-plugin &lsqb;com.atlassian.ratelimiting.rate-limiting-plugin &lsqb;59&rsqb;&lpar;R 59.0&rpar;&rsqb; because it is exposed to package 'javax.ws.rs' from resources com.atlassian.plugins.rest.atlassian-rest-v2-plugin &lsqb;com.atlassian.plugins.rest.atlassian-rest-v2-plugin &lsqb;56&rsqb;&lpar;R 56.0&rpar;&rsqb; and org.apache.felix.framework &lsqb;org.apache.felix.framework &lsqb;0&rsqb;&lpar;R 0&rpar;&rsqb; via two dependency chains.<br/><br/>Chain 1:<br/>&nbsp;&nbsp;com.atlassian.ratelimiting.rate-limiting-plugin &lsqb;com.atlassian.ratelimiting.rate-limiting-plugin &lsqb;59&rsqb;&lpar;R 59.0&rpar;&rsqb;<br/>&nbsp;&nbsp;&nbsp;&nbsp;import: (osgi.wiring.package=javax.ws.rs)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#124; <br/>&nbsp;&nbsp;&nbsp;&nbsp;export: osgi.wiring.package: javax.ws.rs<br/>&nbsp;&nbsp;com.atlassian.plugins.rest.atlassian-rest-v2-plugin &lsqb;com.atlassian.plugins.rest.atlassian-rest-v2-plugin &lsqb;56&rsqb;&lpar;R 56.0&rpar;&rsqb;<br/><br/>Chain 2:<br/>&nbsp;&nbsp;com.atlassian.ratelimiting.rate-limiting-plugin &lsqb;com.atlassian.ratelimiting.rate-limiting-plugin &lsqb;59&rsqb;&lpar;R 59.0&rpar;&rsqb;<br/>&nbsp;&nbsp;&nbsp;&nbsp;import: (osgi.wiring.package=com.atlassian.plugins.rest.common.security)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#124;<br/>&nbsp;&nbsp;&nbsp;&nbsp;export: osgi.wiring.package=com.atlassian.plugins.rest.common.security; uses:=javax.ws.rs<br/>&nbsp;&nbsp;com.atlassian.plugins.rest.atlassian-rest-module &lsqb;com.atlassian.plugins.rest.atlassian-rest-module &lsqb;55&rsqb;&lpar;R 55.0&rpar;&rsqb;<br/>&nbsp;&nbsp;&nbsp;&nbsp;import: (&amp;(osgi.wiring.package=javax.ws.rs)(version&gt;=1.1.1))<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#124;<br/> &nbsp;&nbsp;&nbsp;&nbsp;export: osgi.wiring.package: javax.ws.rs<br/> &nbsp;&nbsp;org.apache.felix.framework &lsqb;org.apache.felix.framework &lsqb;0&rsqb;&lpar;R 0&rpar;&rsqb; Unresolved requirements: &lsqb;&lsqb;com.atlassian.ratelimiting.rate-limiting-plugin &lsqb;59&rsqb;&lpar;R 59.0&rpar;&rsqb; osgi.wiring.package; (osgi.wiring.package=com.atlassian.plugins.rest.common.security)&rsqb;.&nbsp;This error usually occurs when your plugin imports a package from another bundle with a specific version constraint and either the bundle providing that package doesn't meet those version constraints, or there is no bundle available that provides the specified package. For more details on how to fix this, see https://developer.atlassian.com/x/mQAN </code></pre>

#### Solution

<p>Assuming in the example we are migrating rate-limiting-plugin to REST v2</p>
<p>1. In the chain 1, rate-limiting-plugin is importing the package from atlassian-rest-v2-plugin. atlassian-rest-v2-plugin provides the implementation of REST v2, thus this is expected behaviour.</p>
<p>2. In the chain 2, rate-limiting-plugin is importing the package from atlassian-rest-module. The atlassian-rest-module provides the implementation of REST v1, which should not be imported from it.</p>
<p>3. Explicitly, do not import that package in amps-maven-plugin in the pom of that plugin.</p> 
<pre><code>&lt;build&gt;<br/>&nbsp;&nbsp;&lt;plugins&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugin&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.maven.plugins&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;amps-maven-plugin&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;configuration&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;instructions&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Import-Package&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!com.atlassian.plugins.rest.common.security,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Import-Package&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/configuration&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugin&gt;<br/>&nbsp;&nbsp;&lt;/plugins&gt;<br/>&lt;/build&gt;</code></pre>

### Problem 7 - Class com.sun.jersey.wadl.resourcedoc.ResourceDocletJSON is not a valid doclet

#### Problem

Class com.sun.jersey.wadl.resourcedoc.ResourceDocletJSON is not a valid doclet<br/>
<pre><code>[ERROR] Exit code: 1 - error: Class com.sun.jersey.wadl.resourcedoc.ResourceDocletJSON is not a valid doclet.<br/>[ERROR] &nbsp;&nbsp;Note: As of JDK 13, the com.sun.javadoc API is no longer supported.</code></pre>

#### Solution

Add `<skipRestDocGeneration>true</skipRestDocGeneration>` to `amps-maven-plugin` configuration in the plugin<br/> 
<pre><code>&lt;build&gt;<br/>&nbsp;&nbsp;&lt;plugins&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugin&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.maven.plugins&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;amps-maven-plugin&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;configuration&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;skipRestDocGeneration&gt;true&lt;/skipRestDocGeneration&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/configuration&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugin&gt;<br/>&nbsp;&nbsp;&lt;/plugins&gt;<br/>&lt;/build&gt;</code></pre>

### Problem 8 - Annotation not working as intended

#### Problem

Annotation not working as intended<br/> 
<pre><code>org.glassfish.jersey.internal.inject.Providers checkProviderRuntime<br/>WARNING: A provider com.atlassian.ratelimiting.resources.RateLimitCounterResource registered in SERVER runtime does not implement any provider interfaces applicable in the SERVER runtime. Due to constraint configuration problems the provider com.atlassian.ratelimiting.resources.RateLimitCounterResource will be ignored.</code></pre>

#### Solution

<p>The dependency should use provided scope, otherwise it will be the different copy of REST v2 is using.</p>
<p>For example, jakarta.ws.rs-api and jackson-annotations are some of the most common dependencies that are often overlooked in the provided scope.</p>

<p>- EXPECTED:</p><p>The dependency should use provided scope</p>
<pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre> 

<p>You can go to <a href="http://localhost:5990/refapp/plugins/servlet/upm/osgi">http://localhost:5990/refapp/plugins/servlet/upm/osgi</a> and check what is used in the system bundle.</p><br/>
<p>- WRONG: </p><p>The scope of the dependency is not specified, by default the scope is compile</p>
<pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;<br/>&lt;/dependency&gt;</code></pre>

<p>You can go to <a href="http://localhost:5990/refapp/plugins/servlet/upm/osgi">http://localhost:5990/refapp/plugins/servlet/upm/osgi</a> and check what is used in the system bundle.</p>

<p>Only the REST v2 implementation uses the package, while the Entity Marshalling Sample does not</p>

### Problem 9 - NoSuchMethodException: Could not find a suitable constructor

#### Problem

NoSuchMethodException: Could not find a suitable constructor<br/> 
<pre><code>WARNING: The following warnings have been detected: WARNING: HK2 service reification failed for [com.atlassian.ratelimiting.rest.resource.SystemRateLimitSettingsResource] with an exception:<br/>MultiException stack 1 of 2<br/>java.lang.NoSuchMethodException: Could not find a suitable constructor in com.atlassian.ratelimiting.rest.resource.SystemRateLimitSettingsResource class.</code></pre>

#### Solution

<p>- @Inject annotation has to come from the same OSGi bundle of you plugin and in the <b>REST v2 Implementation</b>. Use the provided scope of the javax.inject dependency.</p> 
<pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;jakarta.inject&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;jakarta.inject-api&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre> 

<p>- In the &lt;Import-Package&gt; section of pom.xml, add `javax.inject`</p> 

<pre><code>&lt;build&gt;<br/>&nbsp;&nbsp;&lt;plugins&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugin&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.maven.plugins&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;amps-maven-plugin&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${amps.version}&lt;/version&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;configuration&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;instructions&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Import-Package&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;javax.inject,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Import-Package&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/configuration&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugin&gt;<br/>&nbsp;&nbsp;&lt;/plugins&gt;<br/>&lt;/build&gt;</code></pre> 

<p>&emsp;When you go the OSGI tab of the product (for example: <a href="http://localhost:5990/refapp/plugins/servlet/upm/osgi">http://localhost:5990/refapp/plugins/servlet/upm/osgi</a>) 
and search for &lt;System Bundle.&gt<br>&emsp;Expand the &lt;Export-Package&gt section, you should see your plugin and &lt;REST v2 Implementation&gt are using the same javax.inject</p>

### Problem 10 - Clash Jackson dependencies

#### Problem

Clash Jackson dependencies<br/> <pre><code>&lsqb;INFO&rsqb; &lsqb;talledLocalContainer&rsqb; Caused by: java.lang.NoClassDefFoundError: com/fasterxml/jackson/databind/ObjectMapper<br/>&lsqb;INFO&rsqb; &lsqb;talledLocalContainer&rsqb; 	&amp;lpar;java.base/java.lang.Class.getDeclaredMethods0&amp;rpar;Native Method<br/>&lsqb;INFO&rsqb; &lsqb;talledLocalContainer&rsqb; 	&amp;lpar;java.base/java.lang.Class.privateGetDeclaredMethods&amp;rpar;Class.java:3402<br/>&lsqb;INFO&rsqb; &lsqb;talledLocalContainer&rsqb; 	&amp;lpar;java.base/java.lang.Class.getDeclaredMethods&amp;rpar;Class.java:2504<br/>&lsqb;INFO&rsqb; &lsqb;talledLocalContainer&rsqb; 	&amp;lpar;org.springframework.util.ReflectionUtils.getDeclaredMethods&amp;rpar;ReflectionUtils.java:467<br/>&lsqb;INFO&rsqb; &lsqb;talledLocalContainer&rsqb; 	... 22 more</code></pre><br/>
or<br/>
<pre><code>&lsqb;INFO&rsqb; &lsqb;talledLocalContainer&rsqb; io.atlassian.util.concurrent.LazyReference$InitializationException: A MultiException has 2 exceptions.  They are:<br/>&lsqb;INFO&rsqb; &lsqb;talledLocalContainer&rsqb; 1. java.lang.LinkageError: loader constraint violation for class com.fasterxml.jackson.module.kotlin.KotlinAnnotationIntrospector: when selecting overriding method 'com.fasterxml.jackson.annotation.JsonCreator$Mode com.fasterxml.jackson.module.kotlin.KotlinAnnotationIntrospector.findCreatorAnnotation&amp;lpar;com.fasterxml.jackson.databind.cfg.MapperConfig, com.fasterxml.jackson.databind.introspect.Annotated&amp;rpar;' the class loader org.apache.felix.framework.BundleWiringImpl$BundleClassLoader@59731fa9 of the selected method's type com.fasterxml.jackson.module.kotlin.KotlinAnnotationIntrospector, and the class loader org.apache.catalina.loader.ParallelWebappClassLoader @6a8ebb66 for its super type com.fasterxml.jackson.databind.AnnotationIntrospector have different Class objects for the type com.fasterxml.jackson.annotation.JsonCreator$Mode used in the signature &amp;lpar;com.fasterxml.jackson.module.kotlin.KotlinAnnotationIntrospector is in unnamed module of loader org.apache.felix.framework.BundleWiringImpl$BundleClassLoader @59731fa9, parent loader org.apache.catalina.loader.ParallelWebappClassLoader @6a8ebb66; com.fasterxml.jackson.databind.AnnotationIntrospector is in unnamed module of loader org.apache.catalina.loader.ParallelWebappClassLoader @6a8ebb66, parent loader java.net.URLClassLoader @7ef20235&amp;rpar;<br/>&lsqb;INFO&rsqb; &lsqb;talledLocalContainer&rsqb; 2. java.lang.IllegalStateException: Unable to perform operation: create on com.atlassian.plugins.rest.v2.jersey.RestJacksonJaxbJsonProvider<br/>...<br/>&lsqb;INFO&rsqb; &lsqb;talledLocalContainer&rsqb; Caused by: java.lang.LinkageError: loader constraint violation for class com.fasterxml.jackson.module.kotlin.KotlinAnnotationIntrospector: when selecting overriding method 'com.fasterxml.jackson.annotation.JsonCreator$Mode com.fasterxml.jackson.module.kotlin.KotlinAnnotationIntrospector.findCreatorAnnotation&amp;lpar;com.fasterxml.jackson.databind.cfg.MapperConfig, com.fasterxml.jackson.databind.introspect.Annotated&amp;rpar;' the class loader org.apache.felix.framework.BundleWiringImpl$BundleClassLoader @59731fa9 of the selected method's type com.fasterxml.jackson.module.kotlin.KotlinAnnotationIntrospector, and the class loader org.apache.catalina.loader.ParallelWebappClassLoader @6a8ebb66 for its super type com.fasterxml.jackson.databind.AnnotationIntrospector have different Class objects for the type com.fasterxml.jackson.annotation.JsonCreator$Mode used in the signature &amp;lpar;com.fasterxml.jackson.module.kotlin.KotlinAnnotationIntrospector is in unnamed module of loader org.apache.felix.framework.BundleWiringImpl$BundleClassLoader @59731fa9, parent loader org.apache.catalina.loader.ParallelWebappClassLoader @6a8ebb66; com.fasterxml.jackson.databind.AnnotationIntrospector is in unnamed module of loader org.apache.catalina.loader.ParallelWebappClassLoader @6a8ebb66, parent loader java.net.URLClassLoader @7ef20235&rpar;<br/>[INFO] [talledLocalContainer]    at com.fasterxml.jackson.module.kotlin.KotlinModule.setupModule&lpar;KotlinModule.kt:141&rpar;<br/>[INFO] [talledLocalContainer]    at com.fasterxml.jackson.databind.ObjectMapper.registerModule&lpar;ObjectMapper.java:906&rpar;<br/>[INFO] [talledLocalContainer]    at com.fasterxml.jackson.databind.ObjectMapper.registerModules&lpar;ObjectMapper.java:1108&rpar;<br/>[INFO] [talledLocalContainer]    at com.fasterxml.jackson.databind.ObjectMapper.findAndRegisterModules&lpar;ObjectMapper.java:1192&rpar;<br/>[INFO] [talledLocalContainer]    at com.atlassian.plugins.rest.v2.json.ObjectMapperFactory.createObjectMapper&lpar;ObjectMapperFactory.java:20&rpar;<br/>[INFO] [talledLocalContainer]    at com.atlassian.plugins.rest.v2.jersey.RestJacksonJaxbJsonProvider.&lpar;<init>&rpar;RestJacksonJaxbJsonProvider.java:33</code></pre>

#### Solution

If you already using some Jackson v2 libraries before migrating, make sure you make the scope as provided and check amps-maven-plugin that they are not excluded from the Import-Package.<br/>

<pre><code>&lt;build&gt;<br/>&nbsp;&nbsp;&lt;plugins&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;plugin&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;com.atlassian.maven.plugins&lt;/groupId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;amps-maven-plugin&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;${amps.version}&lt;/version&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;configuration&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;instructions&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Import-Package&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com.fasterxml.jackson*,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Import-Package&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/configuration&gt;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/plugin&gt;<br/>&nbsp;&nbsp;&lt;/plugins&gt;<br/>&lt;/build&gt;</code></pre>You might need to add other Jackson libraries as provided dependencies such as:<br/> <pre><code>&lt;dependency&gt;<br/>&nbsp;&nbsp;&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;<br/>&nbsp;&nbsp;&lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;<br/>&lt;dependency&gt;<br/>&nbsp;&nbsp;&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;<br/>&nbsp;&nbsp;&lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;<br/>&lt;dependency&gt;<br/>&nbsp;&nbsp;&lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;<br/>&nbsp;&nbsp;&lt;artifactId&gt;jackson-datatype-jsr310&lt;/artifactId&gt;<br/>&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;<br/>&lt;/dependency&gt;</code></pre>

### Problem 11 - Spring bean inject not working properly, there are multiple implementations implementations of an interface (on Java)

#### Problem

Spring bean inject not working properly, there are multiple implementations implementations of an interface (on Java)<br/> 
<pre><code>Caused by: org.glassfish.hk2.api.UnsatisfiedDependencyException: There was no object available for injection at SystemInjecteeImpl(requiredType=List&amp;lt;?extends com.atlassian.app.usage.it.service.PluginUsageSimulation&amp;gt;,parent=DataInjectorRestResource,qualifiers={},position=0,optional=false,self=false,unqualified=null,161975997)</code></pre><br/>
or<br/>
<pre><code>1. java.lang.RuntimeException: Found 2 beans of class com.atlassian.sal.api.message.I18nResolver<br/>   2. java.lang.IllegalArgumentException: While attempting to resolve the dependencies of com.atlassian.plugin.notifications.rest.AddNotificationOptionsResource errors were found<br/>   3. java.lang.IllegalStateException: Unable to perform operation: resolve on com.atlassian.plugin.notifications.rest.AddNotificationOptionsResource<br/>   ] with root cause<br/>java.lang.RuntimeException: Found 2 beans of class com.atlassian.sal.api.message.I18nResolver<br/>   at com.atlassian.plugins.rest.v2.jersey.SpringInTimeResolver.justInTimeResolution(SpringInTimeResolver.java:47)</code></pre>

#### Solution

<p>Use the javax.inject.Named annotation on the injected instance.</p>
<p>Named is a string based qualifier that identifies the bean by its name to be injected into the injectee.</p> 
Example injection:<br/>
<pre><code>public class FruitResource {<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;private final Fruit fruit;<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;@Inject<br/>&nbsp;&nbsp;&nbsp;&nbsp;public EntityResource(@Named("orangeFruit") Fruit fruit) {<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.fruit = fruit;<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/>&nbsp;&nbsp;&nbsp;&nbsp;...</code></pre>

Example bean export:<br/> 
<pre><code>public class SpringBeans {<br/>&nbsp;&nbsp;&nbsp;&nbsp;@Bean<br/>&nbsp;&nbsp;&nbsp;&nbsp;public Fruit orangeFruit(){<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Orange();<br/>&nbsp;&nbsp;&nbsp;&nbsp;}<br/>}</code></pre>

### Problem 12 -  Problem - Joda date/time type `org.joda.time.DateTime` not supported by default

#### Problem

Joda date/time type `org.joda.time.DateTime` not supported by default<br/>
<pre><code>Joda date/time type `org.joda.time.DateTime` not supported by default: add Module "com.fasterxml.jackson.datatype:jackson-datatype-joda"<br/>to enable handling (through reference chain: java.util.ArrayList&lsqb;0&rsqb;-&gt;com.atlassian.jira.plugin.triggers.rest.DiagnosticsResource$TransitionFailureJson&lsqb;"date"&rsqb;)</code></pre>

#### Solution

<p>In Restv2, Jackson doesn't support DateTime types by default. It requires a special serializer to be implemented for the DateTime Type-to-schema conversion, 
or a com.fasterxml.jackson.datatype.JodaModule (<a href="https://stackoverflow.com/questions/3269459/how-to-serialize-joda-datetime-with-jackson-json-processor">examples</a>)</p>
<p>Joda.time was removed in Platform 7.
<br>
<p>It is recommended to replace org.joda.time.DateTime type with default supported types: java.time.LocalDateTime or java.time.ZonedDateTime.</p>
<p>If you have an issue with the date format, use the com.fasterxml.jackson.annotation.JsonFormat annotation to modify the marshalled date format.</p>  
<p>Example:</p> 
<pre><code>@JsonProperty<br/>@JsonFormat(shape = JsonFormat.Shape.STRING, pattern = "yyyy-MM-dd'T'HH:mm:ss.SSSZ")<br/>ZonedDateTime date;</code></pre>

<p>The above example changes the ZonedDateTime format to the DateTime format.</p>